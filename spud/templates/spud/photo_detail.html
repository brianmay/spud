{% extends "base_site.html" %}
{% load i18n %}
{% load photo %}
{% load comments %}

{% block stylesheet %}{{ MEDIA_URL }}css/photolists.css{% endblock %}

{% block breadcrumbs %}{% show_breadcrumbs breadcrumbs %}{% endblock %}

{% block title %}{{ object }}{% endblock %}

{% block content %}
{% if page_obj %}
{% pagination_with_links page_obj links %}
{% endif %}

<h1>{{object}} page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</h1>

{% with object.error_list as error_list %}{% if error_list %}
{% show_error_list error_list %}
{% endif %}{% endwith %}

{% get_permissions_from_type "add_perm" "edit_perm" "delete_perm" user object.type %}
<ul class="object-tools">
<li><a class="linklink" href="{{ object.get_absolute_url }}">Link</a></li>
{% if edit_perm %}<li><a class="changelink" href="{% photo_edit_url links page_obj.number %}">Edit</a></li>{% endif %}
{% if edit_perm %}<li><a class="linklink" href="{{ object.get_orig_url }}">Orig</a></li>{% endif %}
</ul>

<div class='photo_detail photo_{{object.status}}'>
<div class='photo_detail_photo'>

<a href="{% get_thumb_url object "hd" %}">
<img src="{% get_thumb_url object "mid" %}" alt="{{ object.title }}" />
</a>
</div>

<div class='photo_detail_photo_detail'>
<h2>Photo Details</h2>

<dl>
{% if object.title %}
<dt>Title</dt><dd>{{object.title}}</dd>
{% endif %}
{% if object.description %}
<dt>Description</dt><dd>{{object.description|urlizetrunc:40|linebreaks}}</dd>
{% endif %}
{% if object.photo_person_set.all %}
<dt>People</dt><dd>
  {% for pp in object.photo_person_set.all %}
    <a href="{{ pp.person.get_absolute_url }}">{{pp.person}}</a> ({{pp.position}}){% if not forloop.last %}; {% endif %}
  {% endfor %}
</dd>
{% endif %}
{% if object.location %}
<dt>Location</dt><dd><a href="{{ object.location.get_absolute_url }}">{{ object.location }}</a></dd>
{% endif %}
<dt>Albums</dt><dd>
  {% for pa in object.photo_album_set.all %}
    <a href="{{ pa.album.get_absolute_url }}">{{pa.album}}</a>{% if not forloop.last %}; {% endif %}
  {% endfor %}
</dd>
<dt>Categories</dt><dd>
  {% for pc in object.photo_category_set.all %}
    <a href="{{ pc.category.get_absolute_url }}">{{pc.category}}</a>{% if not forloop.last %}; {% endif %}
  {% endfor %}
</dd>
<dt>Date &amp; time</dt><dd>
  {{ object.datetime|show_datetime:object.timezone }}
</dd>
{% if object.photographer %}
<dt>Photographer</dt><dd><a href="{{ object.photographer.get_absolute_url }}">{{object.photographer}}</a></dd>
{% endif %}
<dt>Rating</dt><dd>{{object.rating}}</dd>
{% if object.relations_1.all or object.relations_2.all or perms.spud.add_relation %}
<dt>Related photos</dt><dd>
  {% if perms.spud.add_relation %}
    <ul class="object-tools">
    <li><a class="addlink" href="{{ object.get_create_photo_relation_url }}">Create</a></li>
    </ul>
  {% endif %}
  <table>
  {% for relation in object.relations_1.all %}
            {% get_permissions_from_type "r_add_perm" "r_edit_perm" "r_delete_perm" user relation.type %}
            <tr>
            <td><a href="{{ relation.photo_2.get_absolute_url }}">{{ relation.desc_2 }}</a>
            {% if r_edit_perm %}
            <td><a class="changelink" href="{{ relation.get_edit_url }}">Edit</a></td>
            {% endif %}
            {% if r_delete_perm %}
            <td><a class="deletelink" href="{{ relation.get_delete_url }}">Delete</a></td>
            {% endif %}
            </tr>
  {% endfor %}
  {% for relation in object.relations_2.all %}
            {% get_permissions_from_type "r_add_perm" "r_edit_perm" "r_delete_perm" user relation.type %}
            <tr>
            <td><a href="{{ relation.photo_1.get_absolute_url }}">{{ relation.desc_1 }}</a></td>
            {% if r_edit_perm %}
            <td><a class="changelink" href="{{ relation.get_edit_url }}">Edit</a></td>
            {% endif %}
            {% if r_delete_perm %}
            <td><a class="deletelink" href="{{ relation.get_delete_url }}">Delete</a></td>
            {% endif %}
            </tr>
  {% endfor %}
  </table>
</dd>
{% endif %}
{% if user.is_staff %}
{% if object.similar_photos.all %}
<dt>Similar photos</dt><dd>
  {% for photo in object.similar_photos.all %}
    <a href="{{ photo.get_absolute_url }}">{{photo}}</a>{% if not forloop.last %}; {% endif %}
  {% endfor %}
</dd>
{% endif %}
{% endif %}
<dt>Status</dt><dd>{% show_status_with_link object.status %}</dd>
</dl>
</div>

<div class='photo_detail_camera_detail'>
<h2>Camera Details</h2>

<dl>
<dt>Camera</dt><dd>{{object.camera_make}} {{object.camera_model}}</dd>
<dt>Flash</dt><dd>{{object.flash_used}}</dd>
<dt>Focal length</dt><dd> {{object.focal_length}}</dd>
<dt>Exposure</dt><dd>{{object.exposure}}</dd>
<dt>Aperture</dt><dd>{{object.aperture}}</dd>
<dt>ISO</dt><dd>{{object.iso_equiv}}</dd>
<dt>Metering Mode</dt><dd>{{object.metering_mode}}</dd>
</dl>
</div>

<br class="clear"/>
</div>

<div class='photo_detail_comments'>
<h2>Comments</h2>

{% get_comment_list for object as comment_list %}
{% for comment in comment_list %}
    <div class="comment_{% cycle odd,even %}" id="c{{ comment.id }}">
    <span class="comnum"><a id="c{{ comment.id }}" href="#c{{ comment.id }}">#{{ forloop.counter }}</a></span>
    <p><b>{% if comment.user_email %}<a href="mailto:{{ comment.user_email }}">{{ comment.user_name }}</a>{% else %}{{ comment.user_name }}{% endif %}</b> gave the photo a rating of {{ comment.rating }} out of 10, on {{ comment.submit_date|date:"F j, Y" }} at {{ comment.submit_date|date:"P" }}:</p>
    {{ comment.comment|urlizetrunc:40|linebreaks }}
    </div>
{% endfor %}

<h2>Post a comment</h2>

{% render_comment_form for object %}
</div>

{% endblock %}
